*{<meta charset="utf-8">}*
#{extends 'Application/header.html' /}
<h2>マイページ</h2>

<div id="news-block" class="sans-serif">
	<h3>お知らせ</h3>
	<p class="note">2件のお知らせがあります。</p>
	<a class="seeMore" href="@{news()}">過去のお知らせを見る</a>
	<table class="table table-bordered">
		<tbody>
			<tr>
				<td>12/18</td>
				<td>プロジェクト「<a href="@{project()}">H26 情報工学科研究室振り分け</a>」に招待されました。</td>
			</tr>
			<tr>
				<td>12/17</td>
				<td>プロジェクト「<a href="@{project()}">H26 情報工学科研究室振り分け</a>」の結果が出ました。</td>
			</tr>
		</tbody>
	</table>
</div>

<form action="makeProject" style="display:inline">
	<input class="makeproject-btn btn" type="submit" value="プロジェクト作成">
</form>

<button type="button" class="inputinvitationcode-btn btn" data-toggle="modal" data-target="#input-invitation-code-modal">招待コード入力</button>

<div id="invited-projects-block" class="projects-block">
	<div class="view-toggle"><i class="fa fa-caret-up"></i></div>
	<h3>招待されているプロジェクト</h3>
	#{if InR.size()==0 && IR.size()==0}
	<p>プロジェクトはありません。</p>
	#{/if}
	#{else}
	<table class="table table-bordered project-table">
		<tbody>
			<tr id="invitated-project-header">
				<th>プロジェクト</th>
				<th>締め切り</th>
				<th>登録</th>
			</tr>
			<!-- 招待された登録新規 -->
			<!-- 招待された登録未完了 -->
			#{list items:InR, as : 'ele'}
			<tr>
				<td class="column-1"><a href="@{project(ele.id)}">${ele.name}</a></td>
				<td class="column-2">${ele.getDeadlineTime()}</td>
				<td class="column-3"><a class="register-btn btn" href="@{register(ele.id)}">登録する</a></td>
			</tr>
			#{/list}
			<!-- 招待された登録完了 -->
			#{list items:IR, as : 'ele'}
			<tr>
				<td class="column-1"><a href="@{project(ele.id)}">${ele.name}</a></td>
				<td class="column-2">${ele.getDeadlineTime()}</td>
				<td class="column-3">登録済み<br><a class="note" href="@{register(ele.id)}">再登録する</a></td>
			</tr>
			#{/list}
		</tbody>
	</table>
	#{/else}
</div>

<div id="created-projects-block" class="projects-block">
	<div class="view-toggle"><i class="fa fa-caret-up"></i></div>
	<h3>作成したプロジェクト</h3>
	#{if MP.size()==0}
	<p>プロジェクトはありません。</p>
	#{/if}
	#{else}
	<table class="table table-bordered project-table">
		<tbody>
			<tr>
				<th>プロジェクト</th>
				<th>締め切り</th>
				<th>登録</th>
			</tr>
			<!-- 作成したプロジェクト -->
			#{list items:MP, as : 'ele'}
			<tr>
				<td class="column-1"><a href="@{project(ele.id)}">${ele.name}</a> <a class="share" data-toggle="modal" data-target="#invitation-code-modal-${ele.id}"><i class="fa fa-share-alt"></i></a></td>
				<td class="column-2">${ele.getDeadlineTime()}</td>
				<td class="column-3">
				#{if !ele.isFinished()}
					<a class="edit-btn btn" href="@{editProject(ele.id)}">編集する</a>
				#{/if}
				#{else}
					<a class="result-btn btn" href="@{result(ele.id)}">結果を見る</a>
				#{/else}
				</td>
			</tr>
			#{/list}
			<!-- <tr>
				<td class="column-1"><a href="@{project()}">グループ振り分け</a></td>
				<td class="column-2">終了</td>
				<td class="column-3"><a class="result-btn btn" href="@{result()}">結果を見る</a></td>
			</tr> -->
		</tbody>
	</table>
	#{/else}
</div>

<div id="join-projects-block" class="projects-block">
	<div class="view-toggle"><i class="fa fa-caret-up"></i></div>
	<h3>参加したプロジェクト</h3>
	#{if FnR.size()==0 && FR.size()==0}
	<p>プロジェクトはありません。</p>
	#{/if}
	#{else}
	<table class="table table-bordered project-table">
		<tbody>
			<tr>
				<th>プロジェクト</th>
				<th>あなたのグループ</th>
				<th>登録</th>
			</tr>
			<!-- 終了した登録未完了 -->
			#{list items:FnR, as : 'ele'}
			<tr>
				<td class="column-1"><a href="@{project(ele.id)}">${ele.name}</a></td>
				<td class="column-2">
					#{if ug_map.get(ele.id)==null}
						なし
					#{/if}
					#{else}
						${ug_map.get(ele.id).name}
					#{/else}
				</td>
				<td class="column-3"><a class="result-btn btn" href="@{result(ele.id)}">結果を見る</a></td>
			</tr>
			#{/list}
			<!-- 終了した登録完了 -->
			#{list items:FR, as : 'ele'}
			<tr>
				<td class="column-1"><a href="@{project(ele.id)}">${ele.name}</a></td>
				<td class="column-2">
					#{if ug_map.get(ele.id)==null}
						なし
					#{/if}
					#{else}
						${ug_map.get(ele.id).name}
					#{/else}
				</td>
				<td class="column-3"><a class="result-btn btn" href="@{result(ele.id)}">結果を見る</a></td>
			</tr>
			#{/list}
		</tbody>
	</table>
	#{/else}

</div>

<!-- 招待コード入力 Modal -->
<div class="modal fade" id="input-invitation-code-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h3 class="modal-title" id="myModalLabel">招待コード入力</h3>
      </div>
      <div class="modal-body">
    <div class="input-group">
      <span class="input-group-addon">招待コード</span>
      <input class="form form-control" type="text" name="invitation_code">
    </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">閉じる</button>
        <button id="input-invitation-code-btn" type="button" class="btn btn-primary" disabled data-dismiss="modal">送信する</button>
      </div>
    </div>
  </div>
</div>

#{list items:MP, as : 'ele'}
	<div class="modal fade invitation-code-modal" id="invitation-code-modal-${ele.id}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
	  <div class="modal-dialog" role="document">
	    <div class="modal-content">
	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	        <h3 class="modal-title" id="myModalLabel">「${ele.name}」招待コードの発行</h3>
	      </div>
	      <div class="modal-body">
	      	<div class="input-group">
		      <span class="input-group-addon">招待コードを有効にする</span>
		      <select id="is-valid-invitation-${ele.id}" class="form-control form-number select-valid-invitation" name="invitation">
		        <option value="1" #{if ele.valid_invitation}selected#{/if}>はい</option>
		        <option value="2" #{if !ele.valid_invitation}selected#{/if}>いいえ</option>
		      </select>
		    </div>
	     	
		    <div class="input-group">
		      <span class="input-group-addon">招待コード</span>
		      <p class="form-control no-deco-form invitation-code">
		      	#{if ele.valid_invitation}
		      		${ele.invitation_code}
		   		#{/if}
		   		#{else}
		   			招待コードを有効にしてください
		   		#{/else}
		      </p>
		    </div>
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-default" data-dismiss="modal">閉じる</button>
	      </div>
	    </div>
	  </div>
	</div>
#{/list}
